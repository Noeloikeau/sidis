---

title: templates


keywords: fastai
sidebar: home_sidebar

summary: "This module defines `Templates` for embedding arbitrary iterable and replaceable expressions into blocks of text, allowing for metaprogramming and automation of tasks in other languages through python, or simply filling out forms."
description: "This module defines `Templates` for embedding arbitrary iterable and replaceable expressions into blocks of text, allowing for metaprogramming and automation of tasks in other languages through python, or simply filling out forms."
nb_path: "03_templates.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_templates.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Anaconda3\lib\site-packages\numpy\_distributor_init.py:32: UserWarning: loaded more than 1 DLL from .libs:
C:\Anaconda3\lib\site-packages\numpy\.libs\libopenblas.NOIJJG62EMASZI6NYURL6JBKM4EVBGM7.gfortran-win_amd64.dll
C:\Anaconda3\lib\site-packages\numpy\.libs\libopenblas.PYQHXLVVQ7VESDPUVUADXEVJOBGHJPAY.gfortran-win_amd64.dll
  stacklevel=1)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lst2txt" class="doc_header"><code>lst2txt</code><a href="https://github.com/Noeloikeau/sidis/tree/master/sidis/templates.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lst2txt</code>(<strong><code>ltxt</code></strong>)</p>
</blockquote>
<p>Concatenate a list of text <code>ltxt</code> into a string separated by newlines.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Template" class="doc_header"><code>class</code> <code>Template</code><a href="https://github.com/Noeloikeau/sidis/tree/master/sidis/templates.py#L75" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Template</code>(<strong><code>temp</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Automates iteration over arbitrary Python functions embedded into blocks of text.</p>
<p>Class attrs:</p>

<pre><code>funcs=[[`ZIP`](/sidis/templates.html#ZIP)] (list of callable) : the keyword function to map over the text it's embedded in

filler=[`fill`](/sidis/conversion.html#fill) (callable) : method of filling the text


</code></pre>
<p>Inputs:</p>

<pre><code>`temp` (str): input string to be filled, or file name to be loaded

`kwargs` (dict): characters to be replaced and evaluated


</code></pre>
<p>Attrs:</p>

<pre><code>`plate` (list): line-by-line filling of `temp` based on `kwargs`

`temp` (str): saved version of `temp` separated by newlines


</code></pre>
<p>Methods:</p>

<pre><code>[`load`](/sidis/utils.html#load): loads `fname` and fills based on `kwargs`.

`out`: write/append `txt`, which defaults to filled data `str`, to `fname`.

[`fill`](/sidis/conversion.html#fill): fills the template by replacing `kwargs` and evaluating `funcs`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span><span class="o">=</span><span class="n">Template</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;These characters get replaced: _variable, _function</span>

<span class="s1">This line is then formatted: </span><span class="si">{0}</span><span class="s1"> ZIP _variable , _function</span>

<span class="s1">And this one is iterated: </span><span class="si">{0}</span><span class="s1"> ZIP _iter , _function&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">_variable</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">_function</span><span class="o">=</span><span class="s2">&quot;lambda i:i*10&quot;</span><span class="p">,</span><span class="n">_iter</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">t</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>These characters get replaced: 2, lambda i:i*10
This line is then formatted: 20 
And this one is iterated: 0 
And this one is iterated: 10 </pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What happened? When calling <code>t.fill</code>, <code>_variable</code> was replaced with <code>2</code> everywhere it appeared in the template, similarly with <code>_function</code>. This includes after the custom function <a href="/sidis/templates.html#ZIP"><code>ZIP</code></a>, where they appear as arguments.</p>
<p>After this substitution, <a href="/sidis/templates.html#ZIP"><code>ZIP</code></a> formatted the text preceding it (<code>{0}</code>) with the result of <code>_function(_variable)</code>, i.e, <code>format("{0}",(lambda i:i*10)(2))</code>.</p>
<p>In the next line, <a href="/sidis/templates.html#ZIP"><code>ZIP</code></a> repeatedly formatted the text preceding it (<code>{0}</code>) with the result of <code>_function(_iter)</code>, i.e, <code>'\n'.join([format("{0}",(lambda i:i*10)(j)) for j in range(2)])</code>.</p>
<p>Before we go into more detail on these functions, let's examine the template object:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="vm">__dict__</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;temp&#39;: &#39;These characters get replaced: _variable, _function\n\nThis line is then formatted: {0} ZIP _variable , _function\n\nAnd this one is iterated: {0} ZIP _iter , _function&#39;,
 &#39;plate&#39;: [&#39;These characters get replaced: 2, lambda i:i*10&#39;,
  &#39;This line is then formatted: 20 &#39;,
  &#39;And this one is iterated: 0 &#39;,
  &#39;And this one is iterated: 10 &#39;],
 &#39;_variable&#39;: 2,
 &#39;_function&#39;: &#39;lambda i:i*10&#39;,
 &#39;_iter&#39;: range(0, 2)}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>temp</code> attribute stores the un-formatted text handed to <a href="/sidis/templates.html#Template"><code>Template</code></a>. The <code>plate</code> attribute stores the formatted lines as a list of strings. The object also stores any kwargs as attrs. Finally, <code>text()</code> attribute concatenates the formatted text into a string separated by newlines, and is used as the <code>__repr__</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's see how <a href="/sidis/templates.html#ZIP"><code>ZIP</code></a> works:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ZIP" class="doc_header"><code>ZIP</code><a href="https://github.com/Noeloikeau/sidis/tree/master/sidis/templates.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ZIP</code>(<strong><code>txt</code></strong>, <strong><code>_iter</code></strong>, <strong>*<code>lambdas</code></strong>, <strong><code>as_txt</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Loop over the iterable <code>_iter</code> and format <code>txt</code> in order of the <code>lambdas</code>.
If <code>_iter</code> is an int, it is treated as <code>range(_iter)</code>, and if it is a tuple,
it is treated as <code>np.ndindex(_iter)</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ZIP</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When embedded in the <a href="/sidis/templates.html#Template"><code>Template</code></a>, <a href="/sidis/templates.html#ZIP"><code>ZIP</code></a> treats the text proceeding it as an iterable or a single-substitution, and any text after the <code>,</code> as a list of functions. These functions take the iterable as an argument, and format the text preceding <a href="/sidis/templates.html#ZIP"><code>ZIP</code></a> with their evaluation on the iterable. They do not need to be lambdas - any callable will do. This makes embedding <a href="/sidis/templates.html#ZIP"><code>ZIP</code></a> into other text documents a useful way to modularize the formatting of text, and automate code blocks in other languages which lack Python flexibility.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Other helper functions enabling this process are as follows:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replace" class="doc_header"><code>replace</code><a href="https://github.com/Noeloikeau/sidis/tree/master/sidis/templates.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replace</code>(<strong><code>l</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Replace the line <code>l</code> in <code>txt</code> with any occurances of the dictionaried values.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;result=</span><span class="si">{0}</span><span class="s1">; ZIP _myvar,lambda i:i*10&#39;&#39;&#39;</span><span class="p">,</span><span class="n">_myvar</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;result={0}; ZIP 2,lambda i:i*10&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="txt2lst" class="doc_header"><code>txt2lst</code><a href="https://github.com/Noeloikeau/sidis/tree/master/sidis/templates.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>txt2lst</code>(<strong><code>txt</code></strong>)</p>
</blockquote>
<p>Remove all newlines <code>` and empty strings `` from the template</code>txt`.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">txt</span><span class="o">=</span><span class="n">txt2lst</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;var=_myvar</span>
<span class="s1">result=</span><span class="si">{0}</span><span class="s1">; ZIP _myvar,lambda i:i*10</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">txt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;var=_myvar&#39;, &#39;result={0}; ZIP _myvar,lambda i:i*10&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="getEvals" class="doc_header"><code>getEvals</code><a href="https://github.com/Noeloikeau/sidis/tree/master/sidis/templates.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>getEvals</code>(<strong><code>replaced_txt</code></strong>, <strong><code>funcs</code></strong>=<em><code>['ZIP']</code></em>)</p>
</blockquote>
<p>Obtain a tuple of containing the <code>funcs</code>, the text they format, their arguments,
and their line index in the template <code>txt</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
    <span class="n">txt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">replace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">_myvar</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">getEvals</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="n">funcs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ZIP&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;ZIP&#39;, [&#39;result={0}; &#39;, &#39; 2,lambda i:i*10&#39;], 1)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Text blocks of this kind (<a href="/sidis/templates.html#ZIP"><code>ZIP</code></a>, follows by text to format, follows by arguments after comma) are extracted using <a href="/sidis/templates.html#filltxt"><code>filltxt</code></a>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="filltxt" class="doc_header"><code>filltxt</code><a href="https://github.com/Noeloikeau/sidis/tree/master/sidis/templates.py#L55" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>filltxt</code>(<strong><code>txt</code></strong>, <strong><code>funcs</code></strong>=<em><code>['ZIP']</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Take a template <code>txt</code>, replace all <code>kwargs</code> via <code>Replace</code>, then evaluate the <code>funcs</code>
on the surrounding text using <code>GetEvals</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These are then packaged into the <a href="/sidis/templates.html#Template"><code>Template</code></a> class, which we give another arbitrary example of here:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span><span class="o">=</span><span class="n">Template</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Filling out _stuff</span>

<span class="s1">which </span><span class="si">{0}{1}</span><span class="s1"> is ZIP 1, lambda t:&#39;iterates &#39; , _arbitrarily</span>

<span class="si">{0}</span><span class="s1"> ZIP range(3), lambda t: &quot;much&quot;</span>

<span class="s1">easier</span>

<span class="s1">since we can embed any keyword, iterable, and function anywhere.</span>

<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span><span class="n">_stuff</span><span class="o">=</span><span class="s1">&#39;stuff&#39;</span><span class="p">,</span><span class="n">_arbitrarily</span><span class="o">=</span><span class="s2">&quot;lambda t: &#39;arbitrarily&#39;&quot;</span><span class="p">)</span>
<span class="n">t</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Filling out stuff
which iterates arbitrarily is 
much 
much 
much 
easier
since we can embed any keyword, iterable, and function anywhere.</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="s1">&#39;we can append, _too&#39;</span><span class="p">,</span><span class="n">_too</span><span class="o">=</span><span class="s1">&#39;too!&#39;</span><span class="p">,</span><span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">t</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Filling out stuff
which iterates arbitrarily is 
much 
much 
much 
easier
since we can embed any keyword, iterable, and function anywhere.
we can append, too!</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, a <a href="/sidis/templates.html#Template"><code>Template</code></a> will attempt to auto-load a file if the input is a filename, e.g <code>Template('template.txt')</code> will load the file <code>template.txt</code> if it exists in the current directory, and use that as the string to format.</p>

</div>
</div>
</div>
</div>
 

